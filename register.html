<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<style>
  #password-requirements {
    list-style: none;
    padding: 0;
  }
  #password-requirements li {
    color: red;
  }
  #password-requirements li.valid {
    color: rgb(64, 255, 64);
  }
</style>
</head>
<body>
    <img src="images/logoC.png" alt="Logo de la p치gina" class="logo">
    <h1>Registro de Usuario</h1>
    <form id="registerForm" action="/register" method="post">
        <label for="username">Nombre de Usuario:</label>
        <input type="text" id="username" name="username" required><br><br>

        <label for="email">Correo Electr칩nico:</label>
        <input type="email" id="email" name="email" required><br><br>

        <label for="password">Contrase침a:</label>
        <input type="password" id="password" name="password" required><br><br>
        
        <div class="password-requirements">
            <ul id="password-requirements">
                <li id="length">Al menos 8 caracteres</li>
                <li id="uppercase">Al menos una letra may칰scula</li>
                <li id="lowercase">Al menos una letra min칰scula</li>
                <li id="number">Al menos un n칰mero</li>
                <li id="symbol">Al menos un s칤mbolo (ejemplo: !, @, #, $, %, etc.)</li>
            </ul>
        </div>



        <!--
        <div id="password-strength-message"></div><br>
    -->
        <button type="submit" id="submitButton">Registrarse</button>
    </form>

<script>
  const passwordInput = document.getElementById('password');
  const form = document.getElementById('registerForm');

  passwordInput.addEventListener('keyup', validatePassword);

  function validatePassword() {
    const password = passwordInput.value;

    toggleRequirement('length', password.length >= 8);
    toggleRequirement('uppercase', /[A-Z]/.test(password));
    toggleRequirement('lowercase', /[a-z]/.test(password));
    toggleRequirement('number', /\d/.test(password));
    toggleRequirement('symbol', /[!@#\$%\^\&*\)\(+=._-]/.test(password));
  }

  function toggleRequirement(id, condition) {
    const element = document.getElementById(id);
    element.classList.toggle('valid', condition);
  }

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    const password = passwordInput.value;
    const isValid =
      password.length >= 8 &&
      /[A-Z]/.test(password) &&
      /[a-z]/.test(password) &&
      /\d/.test(password) &&
      /[!@#\$%\^\&*\)\(+=._-]/.test(password);

    if (!isValid) {
      Swal.fire({
        icon: 'error',
        title: 'Contrase침a inv치lida',
        html: `
          Aseg칰rate de que tu contrase침a cumpla con los siguientes requisitos:
          <ul style="text-align: left; margin-top: 10px;">
            <li>游댮 Al menos 8 caracteres</li>
            <li>游댮 Una letra may칰scula</li>
            <li>游댮 Una letra min칰scula</li>
            <li>游댮 Un n칰mero</li>
            <li>游댮 Un s칤mbolo (como !, @, #, $, etc.)</li>
          </ul>
        `,
        confirmButtonText: 'Entendido',
      });
      return;
    }

    try {
      const response = await fetch('/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      const text = await response.text();

      if (response.status === 400) {
        Swal.fire({
          icon: 'error',
          title: 'Registro fallido',
          text: text,
          confirmButtonText: 'Entendido',
        });
      } else if (response.redirected) {
        Swal.fire({
          icon: 'success',
          title: '춰Registro exitoso!',
          text: 'Tu cuenta ha sido creada correctamente.',
          confirmButtonText: 'Continuar',
        }).then(() => {
          window.location.href = response.url;
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Ocurri칩 un error inesperado.',
          confirmButtonText: 'Entendido',
        });
      }

    } catch (error) {
      console.error('Error al registrar usuario:', error);
      Swal.fire({
        icon: 'error',
        title: 'Error de red',
        text: 'No se pudo conectar con el servidor.',
        confirmButtonText: 'Entendido',
      });
    }
  });
</script>






    <!--
    <script src="password-validation.js"></script>
    <script>
        // Captura los elementos de la p치gina
        const passwordInput = document.getElementById('password');
        const submitButton = document.getElementById('submitButton');
        const strengthMessage = document.getElementById('password-strength-message');

        // Llama a la funci칩n de validaci칩n para manejar la entrada de la contrase침a
        validatePasswordInput(passwordInput, submitButton, strengthMessage);
    </script>
    -->

</body>
</html>
